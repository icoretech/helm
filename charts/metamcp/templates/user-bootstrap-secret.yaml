{{- $users := .Values.users | default (list) -}}
{{- if gt (len $users) 0 -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "metamcp.fullname" . }}-user-bootstrap-cfg
  labels:
    {{- include "metamcp.labels" . | nindent 4 }}
    app.kubernetes.io/component: user-bootstrap
type: Opaque
stringData:
  # This is intentionally a file so the bootstrap/provision jobs can mount it without
  # exposing credentials in pod env vars or ConfigMaps.
  config.json: |
    {{- $cfg := dict "users" $users "disablePublicSignup" (.Values.disablePublicSignup | default false) -}}
    {{- toJson $cfg | nindent 4 }}
{{- end -}}
