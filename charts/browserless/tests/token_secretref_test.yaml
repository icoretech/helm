suite: token wiring
templates:
  - deployment.yaml
tests:
  - it: uses token secret ref when provided
    set:
      config.token: ""
      config.tokenSecretRef.name: browserless-auth
      config.tokenSecretRef.key: token
    asserts:
      - equal:
          path: spec.template.spec.containers[0].env[?(@.name=="TOKEN")].valueFrom.secretKeyRef.name
          value: browserless-auth
      - equal:
          path: spec.template.spec.containers[0].env[?(@.name=="TOKEN")].valueFrom.secretKeyRef.key
          value: token

  - it: supports token via extraEnv
    values:
      - values/valid-extraenv-token.yaml
    asserts:
      - equal:
          path: spec.template.spec.containers[0].env[?(@.name=="TOKEN")].value
          value: from-extra-env
