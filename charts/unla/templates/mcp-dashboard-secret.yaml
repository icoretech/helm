{{- $secretName := "mcp-dashboard-secret" -}}
{{- $existing := lookup "v1" "Secret" .Release.Namespace $secretName -}}
{{- $username := "" -}}
{{- $password := "" -}}
{{- if and $existing (hasKey $existing "data") -}}
  {{- $username = (index $existing.data "super_admin_username") -}}
  {{- $password = (index $existing.data "super_admin_password") -}}
{{- else -}}
  {{- $username = ((.Values.dashboard.SUPER_ADMIN_USERNAME | default "admin") | b64enc) -}}
  {{- $password = ((.Values.dashboard.SUPER_ADMIN_PASSWORD | default (randAlphaNum 10)) | b64enc) -}}
{{- end -}}

apiVersion: v1
kind: Secret
metadata:
  name: mcp-dashboard-secret
type: Opaque
data:
  super_admin_username: {{ $username }}
  super_admin_password: {{ $password }}
